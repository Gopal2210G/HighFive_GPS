<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Service Request Management - Gram Panchayat Management System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/service.css') }}">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h2>Gram Panchayat</h2>
            <p>Management System</p>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item" data-section="announcements" onclick="activateSection('announcements')">
                <i class="fas fa-bullhorn"></i>
                <span>Announcements</span>
            </div>
            <div class="menu-item" data-section="services" onclick="activateSection('services')">
                <i class="fas fa-list"></i>
                <span>Services</span>
            </div>
            <div class="menu-item" data-section="service-requests" onclick="activateSection('service-requests')">
                <i class="fas fa-tasks"></i>
                <span>Pending Service Requests</span>
            </div>
            <!-- New menu items for Welfare Projects -->
            <div class="menu-item" data-section="welfare-projects" onclick="activateSection('welfare-projects')">
                <i class="fas fa-project-diagram"></i>
                <span>Welfare Projects</span>
            </div>
            <div class="menu-item" data-section="welfare-requests" onclick="activateSection('welfare-requests')">
                <i class="fas fa-hands-helping"></i>
                <span>Pending Welfare Requests</span>
            </div>
            <div class="menu-item" data-section="change-password" data-bs-toggle="modal"
                data-bs-target="#changePasswordModal">
                <i class="fas fa-key"></i>
                <span>Change Password</span>
            </div>
            <div class="menu-item" data-section="citizen-portal"
                onclick="window.location.href='{{ url_for('citizen_dashboard', user_id=user_id, citizen_id=employee.citizen_id) }}'">
                <i class="fas fa-user"></i>
                <span>Your Citizen Portal</span>
            </div>
            <div class="menu-item" onclick="window.location.href='{{ url_for('landing') }}'">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </div>
        </div>
    </aside>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">Gram Panchayat Management System</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown">
                            {{ employee_name }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal"
                                    data-bs-target="#changePasswordModal">Change password</a></li>

                            <li><a class="dropdown-item"
                                    href="{{ url_for('citizen_dashboard', user_id=user_id, citizen_id=employee.citizen_id) }}">Access
                                    Citizen Portal</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('landing') }}">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" name="currentPassword"
                                required>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"
                                required>
                        </div>
                        <div id="passwordMessage" class="alert d-none"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="savePasswordBtn" data-user-id="{{ user_id }}">Save
                        Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Flash Message Container -->
    <div class="alert-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}
    </div>

    <!-- Header Section -->
    <header class="header text-center">
        <div class="container">
            <h1>Service & Welfare Management</h1>
            <p class="lead">Review and process service requests and welfare projects</p>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container mt-4">
            <!-- Announcements Section -->
            <div class="content-section" id="announcements">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h4>Announcements</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <div class="table-header">
                                <div class="table-title">Recent Announcements</div>
                                <button class="btn btn-primary" id="addAnnouncementBtn">+ Add Announcement</button>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Heading</th>
                                        <th>Detail</th>
                                        <th>Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="announcements-list">
                                    {% if announcements %}
                                    {% for announcement in announcements %}
                                    <tr>
                                        <td>{{ announcement[1] }}</td>
                                        <td>{{ announcement[2] }}</td>
                                        <td>{{ announcement[3] }}</td>
                                        <td>
                                            <div class="action-btns">
                                                <button class="btn btn-primary edit-announcement"
                                                    data-id="{{ announcement[0] }}" title="Edit"><i
                                                        class="fas fa-edit"></i></button>
                                                <button class="btn btn-danger delete-announcement"
                                                    data-id="{{ announcement[0] }}" title="Delete"><i
                                                        class="fas fa-trash"></i></button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    {% else %}
                                    <tr>
                                        <td colspan="4" style="text-align: center;">No announcements till now</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Section -->
            <div class="content-section" id="services">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h4>Available Services</h4>
                        <button class="btn btn-light" id="addNewServiceBtn">
                            <i class="fas fa-plus-circle"></i> Add New Service
                        </button>
                    </div>
                    <div class="card-body">
                        {% if services %}
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Service ID</th>
                                        <th>Service Type</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="servicesTableBody">
                                    {% for service in services %}
                                    <tr>
                                        <td>{{ service.service_id }}</td>
                                        <td>{{ service.type }}</td>
                                        <td>{{ service.description }}</td>
                                        <td>
                                            <button class="btn btn-primary btn-sm"
                                                onclick="showEditServiceModal('{{ service.service_id }}', '{{ service.type }}', '{{ service.description }}')">
                                                Edit
                                            </button>
                                            <button class="btn btn-danger btn-sm"
                                                onclick="confirmDeleteService('{{ service.service_id }}', '{{ service.type }}')">
                                                Delete
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="alert alert-info">No services available.</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Pending Service Requests Section -->
            <div class="content-section active" id="service-requests">
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h4>Pending Service Requests</h4>
                    </div>
                    <div class="card-body">
                        {% if service_requests %}
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Request ID</th>
                                        <th>Citizen ID</th>
                                        <th>Citizen Name</th>
                                        <th>Service Type</th>
                                        <th>Request Date</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for req in service_requests %}
                                    <tr>
                                        <td>{{ req.request_id }}</td>
                                        <td>{{ req.citizen_id }}</td>
                                        <td>{{ req.citizen_name }}</td>
                                        <td>{{ req.service_type }}</td>
                                        <td>{{ req.request_date.strftime('%Y-%m-%d') if req.request_date else 'N/A' }}
                                        </td>
                                        <td>{{ req.description }}</td>
                                        <td>
                                            <button class="btn btn-success btn-sm"
                                                onclick="showActionModal('{{ req.request_id }}', 'Resolved')">
                                                Resolve
                                            </button>
                                            <button class="btn btn-danger btn-sm"
                                                onclick="showActionModal('{{ req.request_id }}', 'Rejected')">
                                                Reject
                                            </button>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="alert alert-info">No pending service requests found.</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Welfare Projects Section (NEW) -->
            <div class="content-section" id="welfare-projects">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h4>Welfare Projects</h4>
                        <button class="btn btn-light" id="addNewWelfareSchemaBtn" data-bs-toggle="modal" data-bs-target="#addWelfareSchemaModal">
                            <i class="fas fa-plus-circle"></i> Add New Welfare Project
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Schema ID</th>
                                        <th>Project Type</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="welfareSchemasTableBody">
                                    {% for project in welfare_projects %}
                                    <tr>
                                        <td>{{ project.schema_id }}</td>
                                        <td>{{ project.type }}</td>
                                        <td>{{ project.description }}</td>
                                        <td>
                                            <button class="btn btn-primary btn-sm"
                                                onclick="showEditSchemaModal('{{ project.schema_id }}', '{{ project.type }}', '{{ project.description }}')">
                                                Edit
                                            </button>
                                            <form action="{{ url_for('delete_welfare_schema') }}" method="POST" style="display: inline;">
                                                <input type="hidden" name="schema_id" value="{{ project.schema_id }}">
                                                <input type="hidden" name="user_id" value="{{ user_id }}">
                                                <input type="hidden" name="employee_id" value="{{ employee_id }}">
                                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this welfare project?');">
                                                    Delete
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% if not welfare_projects %}
                        <div class="alert alert-info">No welfare projects available.</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Pending Welfare Requests Section (NEW) -->
            <div class="content-section" id="welfare-requests">
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h4>Welfare Enrollments</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Enrollment ID</th>
                                        <th>Citizen ID</th>
                                        <th>Citizen Name</th>
                                        <th>Project</th>
                                        <th>Request Date</th>
                                        <th>Joining Date</th>
                                        <th>Status</th>
                                        <th>Description</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for req in welfare_requests %}
                                    <tr>
                                        <td>{{ req.enrollment_id }}</td>
                                        <td>{{ req.citizen_id }}</td>
                                        <td>{{ req.citizen_name }}</td>
                                        <td>{{ req.schema_type }}</td>
                                        <td>{{ req.request_date.strftime('%Y-%m-%d') if req.request_date else 'N/A' }}</td>
                                        <td>{{ req.joining_date.strftime('%Y-%m-%d') if req.joining_date else 'N/A' }}</td>
                                        <td>{{ req.status }}</td>
                                        <td>{{ req.description }}</td>
                                        <td>
                                            {% if req.status == 'Pending' %}
                                            <button class="btn btn-success btn-sm"
                                                onclick="showWelfareActionModal('{{ req.enrollment_id }}', 'Enrolled')">
                                                Approve
                                            </button>
                                            <button class="btn btn-danger btn-sm"
                                                onclick="showWelfareActionModal('{{ req.enrollment_id }}', 'Rejected')">
                                                Reject
                                            </button>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% if not welfare_requests %}
                        <div class="alert alert-info">No welfare enrollments found.</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Status Update -->
    <div class="modal fade" id="actionModal" tabindex="-1" aria-labelledby="actionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" id="actionModalHeader">
                    <h5 class="modal-title" id="actionModalLabel">Service Request Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="actionForm" method="POST" action="{{ url_for('update_service_request_status') }}">
                    <div class="modal-body">
                        <input type="hidden" id="request_id" name="request_id">
                        <input type="hidden" id="status" name="status">
                        <input type="hidden" name="employee_id" value="{{ employee_id }}">
                        <input type="hidden" name="user_id" value="{{ user_id }}">

                        <div class="mb-3">
                            <label for="description" class="form-label">Comments/Description:</label>
                            <textarea class="form-control" id="description" name="description" rows="3"
                                required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for Adding New Service -->
    <div class="modal fade" id="addServiceModal" tabindex="-1" aria-labelledby="addServiceModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addServiceModalLabel">Add New Service</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <form method="POST" action="{{ url_for('add_service') }}" id="addServiceForm">
                    <div class="modal-body">
                        <input type="hidden" name="user_id" value="{{ user_id }}">
                        <input type="hidden" name="employee_id" value="{{ employee_id }}">

                        <div class="mb-3">
                            <label for="service_type" class="form-label">Service Name/Type:</label>
                            <input type="text" class="form-control" id="service_type" name="service_type" required>
                        </div>
                        <div class="mb-3">
                            <label for="service_description" class="form-label">Description:</label>
                            <textarea class="form-control" id="service_description" name="service_description" rows="3"
                                required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success" id="addServiceBtn">Add Service</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for Editing Service -->
    <div class="modal fade" id="editServiceModal" tabindex="-1" aria-labelledby="editServiceModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="editServiceModalLabel">Edit Service</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>
                <form method="POST" action="{{ url_for('update_service') }}">
                    <div class="modal-body">
                        <input type="hidden" id="edit_service_id" name="service_id">
                        <input type="hidden" name="user_id" value="{{ user_id }}">
                        <input type="hidden" name="employee_id" value="{{ employee_id }}">

                        <div class="mb-3">
                            <label for="edit_service_type" class="form-label">Service Name/Type:</label>
                            <input type="text" class="form-control" id="edit_service_type" name="service_type" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit_service_description" class="form-label">Description:</label>
                            <textarea class="form-control" id="edit_service_description" name="service_description"
                                rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Service</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for Adding New Welfare Schema (NEW) -->
    <div class="modal fade" id="addWelfareSchemaModal" tabindex="-1" aria-labelledby="addWelfareSchemaModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addWelfareSchemaModalLabel">Add New Welfare Project</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="POST" action="{{ url_for('add_welfare_schema') }}" id="addWelfareSchemaForm">
                    <div class="modal-body">
                        <input type="hidden" name="user_id" value="{{ user_id }}">
                        <input type="hidden" name="employee_id" value="{{ employee_id }}">

                        <div class="mb-3">
                            <label for="schema_type" class="form-label">Project Name/Type:</label>
                            <input type="text" class="form-control" id="schema_type" name="schema_type" required>
                        </div>
                        <div class="mb-3">
                            <label for="schema_description" class="form-label">Description:</label>
                            <textarea class="form-control" id="schema_description" name="schema_description" rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success" id="addWelfareSchemaBtn">Add Project</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for Editing Welfare Schema (NEW) -->
    <div class="modal fade" id="editSchemaModal" tabindex="-1" aria-labelledby="editSchemaModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="editSchemaModalLabel">Edit Welfare Project</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form method="POST" action="{{ url_for('update_welfare_schema') }}">
                    <div class="modal-body">
                        <input type="hidden" id="edit_schema_id" name="schema_id">
                        <input type="hidden" name="user_id" value="{{ user_id }}">
                        <input type="hidden" name="employee_id" value="{{ employee_id }}">

                        <div class="mb-3">
                            <label for="edit_schema_type" class="form-label">Project Name/Type:</label>
                            <input type="text" class="form-control" id="edit_schema_type" name="schema_type" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit_schema_description" class="form-label">Description:</label>
                            <textarea class="form-control" id="edit_schema_description" name="schema_description" rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Project</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for Welfare Action (NEW) -->
    <div class="modal fade" id="welfareActionModal" tabindex="-1" aria-labelledby="welfareActionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" id="welfareActionModalHeader">
                    <h5 class="modal-title" id="welfareActionModalLabel">Welfare Enrollment Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="welfareActionForm" method="POST" action="{{ url_for('update_welfare_enrollment_status') }}">
                    <div class="modal-body">
                        <input type="hidden" id="welfare_enrollment_id" name="enrollment_id">
                        <input type="hidden" id="welfare_status" name="status">
                        <input type="hidden" name="employee_id" value="{{ employee_id }}">
                        <input type="hidden" name="user_id" value="{{ user_id }}">

                        <div class="mb-3">
                            <label for="welfare_description" class="form-label">Comments/Description:</label>
                            <textarea class="form-control" id="welfare_description" name="description" rows="3"
                                required></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Announcement Modal -->
    <div class="modal fade" id="addAnnouncementModal" tabindex="-1" aria-labelledby="addAnnouncementModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addAnnouncementModalLabel">Add Announcement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="announcementHeading">Heading</label>
                        <input type="text" id="announcementHeading" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="announcementDetail">Detail</label>
                        <textarea id="announcementDetail" class="form-control"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveAnnouncementBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Announcement Modal -->
    <div class="modal fade" id="editAnnouncementModal" tabindex="-1" aria-labelledby="editAnnouncementModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editAnnouncementModalLabel">Edit Announcement</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="editAnnouncementHeading">Heading</label>
                        <input type="text" id="editAnnouncementHeading" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="editAnnouncementDetail">Detail</label>
                        <textarea id="editAnnouncementDetail" class="form-control"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateAnnouncementBtn">Update</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer text-center">
        <div class="container">
            <p>© 2025 Gram Panchayat Management System | Government of India</p>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        const addAnnouncementUrl = "{{ url_for('add_announcement') }}";
        const getAnnouncementsUrl = "{{ url_for('get_announcements') }}";
        const getAnnouncementUrl = "{{ url_for('get_announcement', announcement_id=0).replace('0', '') }}";
        const updateAnnouncementUrl = "{{ url_for('update_announcement', announcement_id=0).replace('0', '') }}";
        const deleteAnnouncementUrl = "{{ url_for('delete_announcement', announcement_id=0).replace('0', '') }}";

        function activateSection(section) {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.menu-item[data-section="${section}"]`).classList.add('active');

            document.querySelectorAll('.content-section').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(section).classList.add('active');
        }

        // Set initial active section
        document.addEventListener('DOMContentLoaded', function () {
            activateSection('service-requests');
        });

        function confirmDeleteService(serviceId, serviceType) {
            if (confirm(`Are you sure you want to delete the service "${serviceType}"? This action cannot be undone.`)) {
                // Create a form to submit the delete request
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{{ url_for('delete_service') }}";

                // Add the necessary fields
                const serviceIdField = document.createElement('input');
                serviceIdField.type = 'hidden';
                serviceIdField.name = 'service_id';
                serviceIdField.value = serviceId;

                const userIdField = document.createElement('input');
                userIdField.type = 'hidden';
                userIdField.name = 'user_id';
                userIdField.value = "{{ user_id }}";

                const employeeIdField = document.createElement('input');
                employeeIdField.type = 'hidden';
                employeeIdField.name = 'employee_id';
                employeeIdField.value = "{{ employee_id }}";

                // Append fields to form
                form.appendChild(serviceIdField);
                form.appendChild(userIdField);
                form.appendChild(employeeIdField);

                // Append form to body and submit
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Function to show edit schema modal (NEW)
        function showEditSchemaModal(schemaId, schemaType, schemaDescription) {
            document.getElementById('edit_schema_id').value = schemaId;
            document.getElementById('edit_schema_type').value = schemaType;
            document.getElementById('edit_schema_description').value = schemaDescription;

            var editSchemaModal = new bootstrap.Modal(document.getElementById('editSchemaModal'));
            editSchemaModal.show();
        }

        // Fix for Add Service modal button
        document.addEventListener('DOMContentLoaded', function () {
            const addNewServiceBtn = document.getElementById('addNewServiceBtn');
            if (addNewServiceBtn) {
                addNewServiceBtn.addEventListener('click', function () {
                    const addServiceModal = new bootstrap.Modal(document.getElementById('addServiceModal'));
                    addServiceModal.show();
                });
            }
        });
    </script>
    <script src="{{ url_for('static', filename='scripts/service.js') }}"></script>
</body>

</html>